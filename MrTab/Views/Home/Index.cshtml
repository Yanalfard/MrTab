<link href="~/css/croppie.css" rel="stylesheet" />
<link href="~/css/uikit.min.css" rel="stylesheet" />
<link href="~/css/Controls.min.css" rel="stylesheet" />
<link href="~/css/Global.min.css" rel="stylesheet" />


<!-- This is a button toggling the modal -->
<button uk-toggle="target: #my-id" type="button">OI</button>

<!-- This is the modal -->
<div id="my-id" uk-modal>
    <div class="popup-croppie column uk-margin-auto">
        <div class="controls uk-width-1-1 row ">
            <input type="file" id="files" onchange="fileSelected(this)" class="display-none">
            <label class="button-icon" for="files">
                <span uk-icon="image"></span>
            </label>
            <button class="button-icon" onclick="crop()">
                <span uk-icon="crop"></span>
            </button>
            @*<button class="button-icon uk-margin-auto-left" onclick="window.history.back()">
                        <span uk-icon="close"></span>
                </button>*@
            <button class="button-icon uk-margin-auto-left uk-modal-close">
                <span uk-icon="close"></span>
            </button>
        </div>
        <img src="~/resources/svg/Image.svg" id="item" />
    </div>
</div>


<script src="~/js/uikit.min.js"></script>
<script src="~/js/uikit-icons.js"></script>
<script src="~/js/croppie.js"></script>

<script>
    const opt = {
        viewport: {
            width: 100,
            height: 100
        }
    }

    var c;
    function fileSelected(input) {
        if (input.files[0] == null) return;

        if (c != undefined) {
            const popup = document.getElementsByClassName('popup-croppie')[0];
            c.destroy();
        }

        var image = new Image();
        image.src = input.value;

        var reader = new FileReader();
        reader.onload = function () {
            var dataURL = reader.result;
            var output = document.getElementById('item');
            output.src = dataURL;
            c = new Croppie(document.getElementById('item'), opt);
        };
        reader.readAsDataURL(input.files[0]);
    }

    //Returns the Base64 string of a WebP image
    function crop() {
        try {
            c.result({ type: 'base64', size: 'viewport', format: 'webp', quality: 1, circle: false }).then(i => {
                //var image = new Image();
                //image.src = i;
                //document.getElementById('content').appendChild(image);
                return i;
            });
        }
        catch{
            UIkit.notification('لطفا یک عکس انتخاب کنید');
        }
    }
</script>